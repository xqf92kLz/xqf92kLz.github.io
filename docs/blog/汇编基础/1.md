

编辑

- 安装工具软件 editplus，下载 [汇编语言加亮插件](http://cc.zju.edu.cn/bhh/asm-syntax.rar)
- 注意文件名最多 8 个字符（不能包含空格、特殊符号）

调试

- vmware + xp 虚拟机

    将 `1.asm` 文件复制到 xp 虚拟机的 D:\masm 内，然后打开 command（开始→运行→输入 command）：

    ```
    d:
    cd \masm
    masm 1.asm;
    link 1.obj;
    td 1.exe
    ```

    实际上可以省略 `.asm`，`.obj`，`.exe`：

    ```
    d:
    cd masm
    masm 1;
    link 1;
    td 1
    ```

    在 xp 虚拟机上，给 C:\WINDOWS\system32\cmd.exe 创建快捷方式，放到桌面上。选中此快捷方式→属性→目标改成 C:\WINDOWS\system32\cmd.exe "/k d:&&cd d:\masm&&command"，下次可以少输 d: 和 cd \masm。

    ??? info "调试"

        F7 Trace into 单步执行（带跟踪），F8 Step over 单步执行（不带跟踪）
        
        F2 Toggle 设置断点再 F9 Run 运行到断点处，或 F4 Goto Cursor 运行到光标处
        
        Ctrl+F2 重置（Run - Program reset）
        
        Alt-F5 查看输出（Windows - User screen）。
        
        寄存器那部分右键 → Registers 32-bit，显示 32 位（或先 Tab 再 Ctrl+r）
        
        Ctrl+G 跳转到指定地址
    
    
    使用修改版 TD（显示 `DS:`、`SS:` 等）：把 xp 虚拟机原 d:\masm\TD.exe 在重命名为 TD0.exe，然后把新的 TD.exe 复制到 d:\masm 中。

- bochs 虚拟机（[下载链接](http://cc.zju.edu.cn/bhh/bochs@bw.zip)）

    用 editdisk 打开 `dos.img`（虚拟机硬盘文件），将 `1.asm` 复制到 `dos.img` 的 \masm 文件夹内。

    打开 bochs，load → d:\bochs@bw\dos.bxrc（虚拟机配置文件）→ start

    Bochs Enhanced Debugger 子窗口，点 Continue

    bochs for windows 子窗口，选择 soft-ice，然后

    ```
    cd \masm
    masm 1;
    link 1;
    td 1
    ```
	
	若调试，用 `ldr 1`。F6 或命令 `EC` 让光标在命令窗和代码窗之间切换。命令 `D 地址` 在数据窗中观察该地址指向的数据，命令 `U 地址` 在代码窗中观察该地址指向的函数体，`U cs:ip` 或 `.` 在代码窗中回到当前正在跟踪的指令处。
	
    点 Power 关闭 Bochs 虚拟机。
    
    
    使用修改版 TD（显示 `DS:`、`SS:` 等）：把 bochs 虚拟机原 c:\masm\TD.exe 重命名为 td0.exe，然后把新的 TD.exe 复制到 c:\masm 中。