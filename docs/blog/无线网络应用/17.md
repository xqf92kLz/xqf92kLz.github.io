第五次课

- 17.1 小型网络中的设备

    - （1）小型网络拓扑构成

        小型网络设计简洁、设备数量少，典型架构包含以下组件：

        - 核心基础设备：1 台路由器（负责 WAN 互联与路由转发）、若干台交换机（实现 LAN 内终端接入与数据交换）、用户 PC（终端节点）；
        - 可选扩展设备：无线 AP（或无线路由器，提供无线接入）、IP 电话（实现企业语音通信）；
        - 外网连接方式：通过单条 WAN 链路（如电缆、DSL）完成与 Internet 的互联，满足外网访问需求。

    - （2）小型网络的管理特点

        小型网络的运维工作以现有设备维护和故障排除为主，且多数场景下由第三方公司技术人员承接，企业内部一般不配备专职网络运维团队。

    - （3）设备选择的核心考量维度

        为匹配业务需求，选择网络中间设备时需综合评估 5 个关键因素：

        | 考量维度        | 核心关注点                                                   |
        | --------------- | ------------------------------------------------------------ |
        | 成本            | 设备采购成本、后期运维与能耗开销                             |
        | 端口            | 端口数量、端口类型（如电口 / 光口）是否适配终端接入规模      |
        | 速度            | 设备数据转发速率能否支撑网络峰值流量                         |
        | 可扩展 / 模块化 | 是否支持后续端口扩容、功能模块升级（如新增光模块、无线模块） |
        | 可管理          | 是否具备 CLI、Web 等便捷配置与监控接口，便于故障排查         |

- 17.2 小型网络的核心规划要点

    - （1）IP 编址规划

        - 基本要求：网络内所有联网设备（路由器、交换机、PC、IP 电话等）必须分配唯一 IP 地址；
        - 管理规范：需提前制定 IP 地址分配方案，做好记录与维护；
        - 规划价值：完整的地址文档可快速定位网络故障节点，同时为资源访问权限控制提供依据（如基于 IP 的访问策略）。

    - （2）网络冗余设计

        - 设计目标：通过冗余规避单点故障，提升网络可靠性（即容错能力）；

        - 实现方式：复制核心网络设备或链路，典型场景包括：

            - 服务器冗余：双服务器部署，一台故障时另一台可无缝接管业务请求；
            - 链路冗余：交换机双链路互联，主链路故障时备用链路自动启用；
            - 设备冗余：部署备用交换机，避免单台交换机故障导致整个 LAN 瘫痪。

    - （3）流量管理（服务质量 QoS）

        - 设计原则：按流量类型划分优先级，保障核心业务数据的传输质量；
        - 优先级排序（从高到低）：语音＞SMTP（邮件）＞即时消息＞FTP（文件传输），其中语音、视频类实时流量优先级最高，需优先送入主干网络；普通数据流量则按默认规则转发。

- 17.3 小型网络扩展为大型网络

    - （1）扩展必要性

        业务增长是小型企业的常态，网络需随业务同步扩容，以满足更多终端接入、更大流量传输的需求。

    - （2）网络扩容的必备要素

        网络扩容需提前做好 4 项准备，为扩容决策提供数据支撑：

        1. 网络文档：包含物理拓扑图（设备物理连接关系）和逻辑拓扑图（IP 网段划分、路由协议部署等）；
        2. 设备清单：详细记录网络内所有设备的型号、位置、运行状态；
        3. 预算：制定财年 IT 设备采购预算，明确扩容设备的资金额度；
        4. 流量分析：统计网络内各类协议（如 TCP、UDP）、应用（如办公软件、业务系统）、服务的流量占比与峰值需求，判断现有设备瓶颈。
    
- 17.4 网络性能基线与 ICMP 协议联动

    - （1）网络性能基线的定义与价值

        - 定义：网络在正常运行状态下的各类性能参数（如带宽利用率、设备 CPU / 内存占用、ping 往返时延等）；
        - 核心价值：是网络 “健康快照”，可作为故障诊断的基准，快速识别网络异常状态。

    - （2）基于 ICMP 协议的连通性与路径测试

        ping 和 traceroute 命令均基于 ICMP 协议实现，具体功能如下：

        1. ping 命令：测试主机间连通性

            - 工作原理：向目标主机发送 ICMP Echo 请求消息，若目标可达则返回 Echo 应答消息；

            - 结果解读（IOS 设备）：

                - `!`：收到应答，连通正常；
                - `.`：请求超时，未连通（可能是路由缺失、防火墙拦截、ARP 解析超时等）；
                - `U`：收到 ICMP 不可达消息，未连通（路由器无目的路由或请求被策略拦截）；

            - 命令形式：标准 ping（`ping 目标IP`，用户 / 特权 EXEC 模式可用）、扩展 ping（直接输入`ping`，仅特权 EXEC 模式，支持自定义数据包大小、超时时间等参数）。

        2. traceroute 命令：测试数据包传输路径

           - 工作原理：利用 IPv4 TTL（生存时间）/IPv6 跳数限制字段和 ICMP 超时消息，通过逐次增加 TTL 值（从 1 开始），获取数据包沿途经过的每一跳路由器地址；
           - 命令差异：Cisco IOS/Linux 系统用`traceroute`，Windows 系统用`tracert`；
           - 结果解读：星号（`*`）表示数据包丢失或设备未应答（多为防火墙策略拦截），数值为每一跳的往返时延，可定位路径中的故障路由器。

- 17.5 主机与 IOS 设备的核心运维命令

    -  （1）Cisco IOS 设备 show 命令（特权 / 用户 EXEC 模式执行）

        show 命令是 IOS 设备故障排查与配置核查的核心工具，常用命令及功能如下：

        | 命令缩写     | 完整命令                | 核心功能                                             |
        | ------------ | ----------------------- | ---------------------------------------------------- |
        | sh run       | show running-config     | 查看设备当前生效的运行配置                           |
        | sh start     | show startup-config     | 查看设备启动时加载的配置（存于 NVRAM）               |
        | sh int       | show interfaces         | 查看接口详细状态（如链路状态、流量统计、错误包数量） |
        | sh ip int b  | show ip interface brief | 查看 IP 接口简要信息（IP 地址、接口状态、协议状态）  |
        | sh arp       | show arp                | 查看设备 ARP 缓存表（IPv4 与 MAC 地址映射关系）      |
        | sh ip route  | show ip route           | 查看设备路由表，确认路由条目是否完整                 |
        | sh protocols | show protocols          | 查看设备已启用的网络协议（如 IP、OSPF、EIGRP 等）    |
        | sh version   | show version            | 查看设备软硬件版本、系统启动时间、设备型号等基础信息 |

    - （2）Windows 主机网络命令

        Windows 主机可通过以下命令核查自身网络配置、管理地址缓存：

        1. IP 配置查询命令
           - `ipconfig`：查看主机 IP 地址、子网掩码、默认网关等基础信息；
           - `ipconfig /all`：查看详细配置，包括 MAC 地址、DHCP 服务器地址、DNS 服务器地址、IP 地址租期等；
           - `ipconfig /displaydns`：查看本地 DNS 缓存（已解析的域名 - IP 映射）；
           - `ipconfig /flushdns`：清除 DNS 缓存（适用于修改 hosts 文件或 DNS 服务器后，获取最新域名解析结果）。
        2. 地址解析缓存管理命令
           - IPv4：`arp -a`查看 ARP 缓存表，`arp -d`清除 ARP 缓存；
           - IPv6：`netsh interface ipv6 show neighbors`查看 IP-MAC 映射，`netsh interface ipv6 delete neighbors`清除映射（IPv6 无 ARP 协议，通过 NDP 协议实现地址解析）。