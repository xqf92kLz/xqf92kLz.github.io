第五次课、第七次课

### 第五次课

- 17.1 小型网络中的设备

    - （1）小型网络拓扑构成

        小型网络设计简洁、设备数量少，典型架构包含以下组件：

        - 核心基础设备：1 台路由器（负责 WAN 互联与路由转发）、若干台交换机（实现 LAN 内终端接入与数据交换）、用户 PC（终端节点）；
        - 可选扩展设备：无线 AP（或无线路由器，提供无线接入）、IP 电话（实现企业语音通信）；
        - 外网连接方式：通过单条 WAN 链路（如电缆、DSL）完成与 Internet 的互联，满足外网访问需求。

    - （2）小型网络的管理特点

        小型网络的运维工作以现有设备维护和故障排除为主，且多数场景下由第三方公司技术人员承接，企业内部一般不配备专职网络运维团队。

    - （3）设备选择的核心考量维度

        为匹配业务需求，选择网络中间设备时需综合评估 5 个关键因素：

        | 考量维度        | 核心关注点                                                   |
        | --------------- | ------------------------------------------------------------ |
        | 成本            | 设备采购成本、后期运维与能耗开销                             |
        | 端口            | 端口数量、端口类型（如电口 / 光口）是否适配终端接入规模      |
        | 速度            | 设备数据转发速率能否支撑网络峰值流量                         |
        | 可扩展 / 模块化 | 是否支持后续端口扩容、功能模块升级（如新增光模块、无线模块） |
        | 可管理          | 是否具备 CLI、Web 等便捷配置与监控接口，便于故障排查         |

- 17.2 小型网络的核心规划要点

    - （1）IP 编址规划

        - 基本要求：网络内所有联网设备（路由器、交换机、PC、IP 电话等）必须分配唯一 IP 地址；
        - 管理规范：需提前制定 IP 地址分配方案，做好记录与维护；
        - 规划价值：完整的地址文档可快速定位网络故障节点，同时为资源访问权限控制提供依据（如基于 IP 的访问策略）。

    - （2）网络冗余设计

        - 设计目标：通过冗余规避单点故障，提升网络可靠性（即容错能力）；

        - 实现方式：复制核心网络设备或链路，典型场景包括：

            - 服务器冗余：双服务器部署，一台故障时另一台可无缝接管业务请求；
            - 链路冗余：交换机双链路互联，主链路故障时备用链路自动启用；
            - 设备冗余：部署备用交换机，避免单台交换机故障导致整个 LAN 瘫痪。

    - （3）流量管理（服务质量 QoS）

        - 设计原则：按流量类型划分优先级，保障核心业务数据的传输质量；
        - 优先级排序（从高到低）：语音＞SMTP（邮件）＞即时消息＞FTP（文件传输），其中语音、视频类实时流量优先级最高，需优先送入主干网络；普通数据流量则按默认规则转发。

- 17.3 小型网络扩展为大型网络

    - （1）扩展必要性

        业务增长是小型企业的常态，网络需随业务同步扩容，以满足更多终端接入、更大流量传输的需求。

    - （2）网络扩容的必备要素

        网络扩容需提前做好 4 项准备，为扩容决策提供数据支撑：

        1. 网络文档：包含物理拓扑图（设备物理连接关系）和逻辑拓扑图（IP 网段划分、路由协议部署等）；
        2. 设备清单：详细记录网络内所有设备的型号、位置、运行状态；
        3. 预算：制定财年 IT 设备采购预算，明确扩容设备的资金额度；
        4. 流量分析：统计网络内各类协议（如 TCP、UDP）、应用（如办公软件、业务系统）、服务的流量占比与峰值需求，判断现有设备瓶颈。
    
- 17.4 网络性能基线与 ICMP 协议联动

    - （1）网络性能基线的定义与价值

        - 定义：网络在正常运行状态下的各类性能参数（如带宽利用率、设备 CPU / 内存占用、ping 往返时延等）；
        - 核心价值：是网络 “健康快照”，可作为故障诊断的基准，快速识别网络异常状态。

    - （2）基于 ICMP 协议的连通性与路径测试

        ping 和 traceroute 命令均基于 ICMP 协议实现，具体功能如下：

        1. ping 命令：测试主机间连通性

            - 工作原理：向目标主机发送 ICMP Echo 请求消息，若目标可达则返回 Echo 应答消息；

            - 结果解读（IOS 设备）：

                - `!`：收到应答，连通正常；
                - `.`：请求超时，未连通（可能是路由缺失、防火墙拦截、ARP 解析超时等）；
                - `U`：收到 ICMP 不可达消息，未连通（路由器无目的路由或请求被策略拦截）；

            - 命令形式：标准 ping（`ping 目标IP`，用户 / 特权 EXEC 模式可用）、扩展 ping（直接输入`ping`，仅特权 EXEC 模式，支持自定义数据包大小、超时时间等参数）。

        2. traceroute 命令：测试数据包传输路径

           - 工作原理：利用 IPv4 TTL（生存时间）/IPv6 跳数限制字段和 ICMP 超时消息，通过逐次增加 TTL 值（从 1 开始），获取数据包沿途经过的每一跳路由器地址；
           - 命令差异：Cisco IOS/Linux 系统用`traceroute`，Windows 系统用`tracert`；
           - 结果解读：星号（`*`）表示数据包丢失或设备未应答（多为防火墙策略拦截），数值为每一跳的往返时延，可定位路径中的故障路由器。

- 17.5 主机与 IOS 设备的核心运维命令

    -  （1）Cisco IOS 设备 show 命令（特权 / 用户 EXEC 模式执行）

        show 命令是 IOS 设备故障排查与配置核查的核心工具，常用命令及功能如下：

        | 命令缩写     | 完整命令                | 核心功能                                             |
        | ------------ | ----------------------- | ---------------------------------------------------- |
        | sh run       | show running-config     | 查看设备当前生效的运行配置                           |
        | sh start     | show startup-config     | 查看设备启动时加载的配置（存于 NVRAM）               |
        | sh int       | show interfaces         | 查看接口详细状态（如链路状态、流量统计、错误包数量） |
        | sh ip int b  | show ip interface brief | 查看 IP 接口简要信息（IP 地址、接口状态、协议状态）  |
        | sh arp       | show arp                | 查看设备 ARP 缓存表（IPv4 与 MAC 地址映射关系）      |
        | sh ip route  | show ip route           | 查看设备路由表，确认路由条目是否完整                 |
        | sh protocols | show protocols          | 查看设备已启用的网络协议（如 IP、OSPF、EIGRP 等）    |
        | sh version   | show version            | 查看设备软硬件版本、系统启动时间、设备型号等基础信息 |

    - （2）Windows 主机网络命令

        Windows 主机可通过以下命令核查自身网络配置、管理地址缓存：

        1. IP 配置查询命令
           - `ipconfig`：查看主机 IP 地址、子网掩码、默认网关等基础信息；
           - `ipconfig /all`：查看详细配置，包括 MAC 地址、DHCP 服务器地址、DNS 服务器地址、IP 地址租期等；
           - `ipconfig /displaydns`：查看本地 DNS 缓存（已解析的域名 - IP 映射）；
           - `ipconfig /flushdns`：清除 DNS 缓存（适用于修改 hosts 文件或 DNS 服务器后，获取最新域名解析结果）。
        2. 地址解析缓存管理命令
           - IPv4：`arp -a`查看 ARP 缓存表，`arp -d`清除 ARP 缓存；
           - IPv6：`netsh interface ipv6 show neighbors`查看 IP-MAC 映射，`netsh interface ipv6 delete neighbors`清除映射（IPv6 无 ARP 协议，通过 NDP 协议实现地址解析）。

### 第七次课

- Cisco 网络故障排除详细梳理

    - 故障排除过程

        - 故障排除核心定义与文档记录
            - 定义：识别、定位并纠正网络问题的过程，可依赖直觉或结构化技术，核心要求是完整文档记录。
            - 文档记录核心内容：
                - 基础信息：具体问题描述、确定原因的步骤、纠正与预防措施
                - 过程信息：所有操作步骤（含未成功步骤）、初始问题、排查结果、最终原因与解决方案
                - 参考价值：网络性能基线数据（用于判断潜在问题），后续同类故障可减少重复工作

        - 信息收集流程
            - 前置动作：收到故障报告后，先验证问题是否存在，明确影响范围。
            - 核心收集步骤：
                - 第一步：询问用户（报告人+受影响用户）
                    - 关键问题：故障症状、错误消息、设备/应用近期配置变更、问题发生时间/人员范围、用户已执行的排查步骤及结果
                    - 示例：帮助台通过询问用户位置（道奇市河东）和问题时间（30分钟前），结合区域雷击事件快速定位故障源
                - 第二步：收集设备与网络信息
                    - 设备信息：制造商、品牌/型号、固件/操作系统版本、所有权/保修信息、IP 地址、MAC 地址、序列号
                    - 配置与拓扑：物理/逻辑拓扑结构、配置文件、日志文件
                    - 工具支持：网络监控工具收集设备状态数据
            - 信息核对表：
                - 问题本质：用户报告、问题确认报告
                - 设备细节：含固件/系统版本、保修信息
                - 配置与拓扑：拓扑图、配置文件、日志
                - 历史记录：过往故障排查步骤与结果

        - 故障排除方法对比
            - 反面典型（不推荐）
            
                | 方法类型       | 核心特征                                  | 问题与局限                          |
                |----------------|-------------------------------------------|-----------------------------------|
                | 理论法（火箭学家方法） | 极致分析故障根源，精准解决                | 耗时过长（数小时/数日），企业网络难以承受长时间中断 |
                | 蛮力法（穴居人方法）   | 盲目更换硬件/软件/线缆，直到网络恢复运行  | 可靠性低，未排除根本原因，仅掩盖症状        |

            - 结构化方法（推荐，基于 OSI 七层模型）
                - OSI 模型提供通用语言，按层次排查可减少混乱，核心有 3 种方法：
                
                    | 方法类型   | 排查顺序                  | 工作原理                                  | 适用场景                          | 优缺点                              |
                    |------------|---------------------------|-------------------------------------------|-----------------------------------|-----------------------------------|
                    | 自上而下   | 应用层→表示层→会话层→传输层→网络层→数据链路层→物理层 | 从用户应用程序开始，逐层向下验证，定位故障层 | 简单故障、疑似应用/上层协议问题    | 优点：针对性强；缺点：若故障在底层，易浪费时间 |
                    | 自下而上   | 物理层→数据链路层→网络层→传输层→会话层→表示层→应用层 | 从物理组件（线缆、硬件）开始，逐层向上验证 | 复杂故障、疑似物理/链路层问题      | 优点：排查彻底；缺点：速度慢，若故障在应用层，效率低 |
                    | 分治法     | 任意层（基于经验/症状判断）→向上/向下延伸 | 先推测故障层，验证正常则排除下层，异常则聚焦该层及下层 | 经验丰富人员、症状明确的故障        | 优点：定位最快；缺点：依赖经验，新手不适用 |

            - OSI 各层故障与检修工具参考
              
                | OSI 层次                | 潜在故障点                                  | 推荐检修工具                          |
                |------------------------|---------------------------------------------|-----------------------------------|
                | 应用层/表示层/会话层（5-7 层） | DNS 解析失败、HTTP/FTP/SMTP 等高层协议失效、应用程序问题 | 网络模拟器、流量发生器、协议分析器        |
                | 传输层（4 层）          | TCP 重传异常、端口占用、TCP 窗口大小问题        | 网络模拟器、流量发生器、协议分析器、网络探测器 |
                | 网络层（3 层）          | IP 寻址冲突、路由协议错误、ICMP 协议故障（如 ping 失败） | 网络探测器、流量分析器                |
                | 数据链路层（2 层）      | 接口配置错误、ARP 表异常、无线电干扰、非物理层硬件错误 | 网络探测器、流量分析器、网络连接工具      |
                | 物理层（1 层）          | 电源故障、线缆损坏、连接头松动/故障          | 电缆测试器、网络连接工具                |

            - 非结构化方法（经验驱动）
            
                | 方法类型 | 核心逻辑                                  | 适用条件                          |
                |----------|-------------------------------------------|-----------------------------------|
                | 试错法   | 基于经验推断故障原因，逐一验证解决方案    | 经验丰富人员、熟悉网络结构的场景        |
                | 替换法   | 更换廉价部件/组件（如线缆、网卡），备份配置文件 | 有备用组件、配置可快速恢复的场景        |

        - 基本故障排除 6 步骤（Cisco IT Essentials 7.02 标准流程）
            - 确定问题：通过开放式问题（如“故障表现是什么？”）和封闭式问题（如“是否能 ping 通网关？”）收集细节
            - 推测潜在原因：聚焦常见诱因（如电缆松动、网卡安装错误）
            - 验证推测：检查线缆连接、重新插拔接头等基础操作
            - 制定并实施方案：未解决则通过技术手册、厂商 FAQ、在线论坛、互联网搜索等补充资源
            - 验证系统功能+实施预防措施：确保全系统恢复，必要时设置防护（如加固线缆、备份配置）
            - 记录归档：详细记录问题、排查步骤、解决方案及结果

    - 排除故障的具体方法及工具

        - 物理问题检测
            - 核心原则：大部分网络故障源于物理层（硬件、线缆、接口），优先使用感官检测
            - 感官检测方法：
                - 视觉：查看 LED 指示灯状态、线缆连接是否松动、设备外观损坏
                - 嗅觉：检测设备烧焦气味（电源/接口故障）
                - 触觉：检查设备温度（过热可能导致故障）、连接头紧固程度
                - 听觉：监听设备异常噪音（风扇故障、硬件冲突）

        - 软件实用程序（CLI 命令为主）
            - ipconfig（IP 配置查询）
                - 核心功能：显示主机 IP 配置信息，支持 Windows 系统
                - 常用参数及用途：
                
                    | 参数          | 功能描述                                  | 适用场景                          |
                    |---------------|-------------------------------------------|-----------------------------------|
                    | ipconfig      | 基础信息：IP 地址、子网掩码、默认网关        | 快速验证 IP 配置是否正确            |
                    | ipconfig /all | 详细信息：MAC 地址、DNS 服务器、DHCP 状态/服务器地址、IP 租借时间 | 排查 DHCP 分配故障、DNS 配置问题      |
                    | ipconfig /release | 释放当前 DHCP 绑定的 IP 地址                  | 需重新获取 IP 时（如 IP 冲突）        |
                    | ipconfig /renew | 向 DHCP 服务器请求新 IP 或续租                | 释放后重新分配 IP                  |
                    | ipconfig /flushdns | 清除 DNS 缓存条目                          | 修改 hosts 文件或 DNS 服务器后，获取最新解析 |
                    | ipconfig /displaydns | 显示本地 DNS 缓存条目                      | 验证 DNS 解析是否缓存错误            |
                    
                - 补充：禁用再启用网卡，等效于执行/release 和/renew

            - ping（连通性测试）
                - 核心原理：基于 ICMP 协议，发送“回应请求”，接收“回应应答”验证主机可达性
                - 用法格式：
                    - ping + IP 地址（如 ping 192.168.7.5）
                    - ping + 域名（如 ping www.cisco.com）
                - 结果解读：
                    - 成功：显示数据包发送/接收数量（默认 4 个）、往返时间（RTT）、丢失率（正常为 0%）
                    - 失败：提示“请求超时”，可能原因：目标主机不可达、防火墙拦截 ICMP、网络层故障

            - tracert（路径追踪）
                - 核心功能：显示数据包到达目标主机的途经路由器（跳数），记录每跳往返时间（RTT）
                - 协议基础：基于 ICMP 协议
                - 适用场景：定位网络瓶颈、数据包丢失/延迟的具体节点
                - 命令差异：Windows 下为 tracert，Cisco IOS 下为 traceroute/trace

            - nslookup（DNS 解析查询）
                - 核心功能：直接查询 DNS 服务器，获取域名对应的 IP 地址及 DNS 服务器信息
                - 适用场景：排查 DNS 解析故障（如域名无法访问，验证是否为 DNS 解析失败）
                - 输出信息：所用 DNS 服务器 IP、目标域名关联的 IP 地址

            - netstat/nbtstat（连接与协议统计）
            
                | 命令       | 核心功能                                  | 常用参数及用途                          | 适用场景                          |
                |------------|-------------------------------------------|-----------------------------------|-----------------------------------|
                | netstat    | 显示活动网络连接、协议统计信息              | -b：查看进程与端口的关联；-n：数字形式显示端口 | 排查端口占用、不明连接（如木马/病毒） |
                | nbtstat    | 显示 NetBIOS 协议统计、TCP/IP 连接的 NetBIOS 名称 | -a + IP：查询本网段主机的 MAC 地址/计算机名 | Windows 系统下，获取本网段设备 MAC 地址 |
                - 补充说明：
                    - 查 MAC 地址替代方案：先 ping 目标主机，再用 arp -a（跨操作系统兼容）
                    - 限制：nbtstat/arp 仅能查询本网段主机的 MAC 地址

    - 常见网络故障及排查要点

        - 连通性问题（有线+无线混合网络）
            - 排查方法：分治法定位故障域
                - 步骤 1：无线客户端 ping 默认网关→验证无线连接
                - 步骤 2：有线客户端 ping 默认网关→验证有线连接
                - 步骤 3：无线客户端 ping 有线客户端→验证集成路由器功能
            - 网络结构参考：Internet 服务商→调制解调器→集成路由器（含 AP）→有线/无线客户端

        - LED 指示灯排查（设备故障快速判断）
            - 指示灯类型：电源灯、状态灯、活动灯（WLAN/WAN/LAN）
            - 常见状态解读（以 TP-LINK 为例）：
                - 电源灯：稳定绿色（正常）、琥珀色（故障）、不亮（未通电）
                - WLAN 灯（无线活动）：闪烁绿色（有数据传输）、不亮（无线未启用/故障）
                - WAN 灯（Internet 活动）：闪烁绿色（正常通信）、琥珀色（连接异常）
                - LAN 灯（以太网活动）：闪烁绿色（有线客户端通信）、不亮（物理连接故障）
            - 排查原则：实验/故障时优先观察指示灯状态

        - 有线网络连通性故障
            - 核心排查点：布线与物理连接（有线网络故障最常见诱因）
            - 布线关键要求：
                - 网线类型：使用正确（直通线/交叉线/反转线）
                - 制作标准：遵循 EIA/TIA 568A 或 568B，端接时避免网线绞合部分解开过长，连接头需压紧
                - 长度限制：不超过对应网线的最大长度（超标会严重影响性能）
                - 端口正确：设备间连接端口匹配（如路由器 LAN 口接交换机上行口）
                - 物理防护：避免网线拉扯、避开过道等易损坏区域

        - WLAN 无线通信故障
            - 核心诱因（RF 信号传输特性导致）：
                - 标准不兼容：802.11a/b/g/n/ac/ax/be/bn 等标准不互通
                - 通道冲突：未使用独立非重叠通道
                - 外部干扰：其他同频率设备（如蓝牙、微波炉）干扰 RF 信号
                - 信号衰减：距离 AP 过远，信号强度不足
                - 带宽限制：AP/无线路由器在多设备间共享带宽，负载过高

        - WLAN 关联与验证故障（配置类问题）
            - 关键配置要求（客户端与 AP/路由器需一致）：
                - SSID（无线网络名称）：必须完全匹配
                - 无线信道：需配置相同非重叠通道
                - 身份验证：默认开放式，严格验证需输入正确密钥
                - 加密设置：加密密钥错误会导致通信失败，无法接入网络

        - DHCP 问题
            - 核心功能：集成无线路由器通常作为 DHCP 服务器，分配 IP 地址、子网掩码、默认网关、DNS 服务器地址
            - 常见故障点：
                - DHCP 未启用：客户端无法自动获取 IP（需手动配置静态 IP）
                - IP 地址池耗尽：无可用 IP 分配给新客户端
                - 配置错误：IP 地址段与其他网络冲突，或 DNS 服务器地址配置错误

        - ISR 与 ISP 连接故障（本地网络正常，无法访问 Internet）
            - 排查方法：
                - 命令测试：ping ISP 网关 IP（如 ping 10.18.32.12），若请求超时则说明连接中断
                - 状态查看：通过路由器 GUI 查看 WAN 口状态信息，验证与 ISP 的连接是否正常
            - 故障本质：集成路由器与 ISP（或调制解调器）之间的链路中断，需联系 ISP 或检查调制解调器/路由器 WAN 口配置