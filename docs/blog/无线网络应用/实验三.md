第四次课

无线网络中 DNS 和 IIS 服务器配置应用实验

### 一、实验核心信息

- 实验目的
    1. 理解域名与 IP 地址的映射关系：域名便于记忆，IP 地址是实际访问地址，DNS 服务器承担“翻译”职责。
    2. 掌握 Windows Server 2019 环境下 DNS 服务器（主、辅）的配置方法。
    3. 掌握 IIS 服务器（Web 服务、FTP 服务）的配置流程。
    4. 实现 WLAN 中多台无线客户端对 DNS 域名解析、Web 站点访问及 FTP 文件传输的功能验证。

- 核心服务基础
    - DNS 服务
        - 定义：域名系统（Domain Name System），是 Internet 中分配名字和地址的机制，允许通过友好域名（如 www.baidu.com）访问主机，而非直接使用 IP 地址（如 36.152.44.95）。
        - 核心角色：
            - 主 DNS 服务器：从本地数据库文件读取数据，存储区域数据正本。
            - 辅 DNS 服务器：通过网络从其他 DNS 服务器（主或其他辅）获取数据（区域传送），分担负载或容错，数据为只读。
        - 关键概念：
            - 正向查找区域：域名→IP 地址映射（核心功能）。
            - 反向查找区域：IP 地址→域名映射（可选，部分程序需用）。
            - 区域传送：辅 DNS 从主 DNS 获取数据的过程，需主 DNS 授权。

    - IIS 服务
        - 定义：互联网信息服务（Internet Information Services），微软基于 Windows 的互联网基本服务，实验使用 IIS 10.0 （支持 Win10/11、Windows Server 2016/2019/2022）。
        - 核心功能：
            - Web 服务（HTTP/HTTPS）：用于网页浏览，默认端口 80。
            - FTP 服务（FTP/FTPS）：用于文件传输，默认端口 21。
        - 版本兼容性：仅 Windows 专业版/服务器版自带，Home 版无 IIS；不同版本 IIS 对应不同 Windows 系统（如 IIS 10.0 适配 Windows Server 2019）。

- 实验拓扑

    | 设备             | 角色                                     | IP 地址                     | 网关                | 域名相关                                                                                                         |
    | ---------- | ---------------------- | ---------------- | ----------- | ------------------------------------------------------------ |
    | PC1                | 主 DNS 服务器（Server1） | 192.168.1.10         | 192.168.1.1 | server1.zjuwlan.com                                                                                    |
    | PC2                | 辅 DNS 服务器（Server2） | 192.168.1.11         | 192.168.1.1 | server2.zjuwlan.com                                                                                    |
    | PC3                | IIS 服务器（Web&FTP）     | 192.168.1.22         | 192.168.1.1 | webserver.zjuwlan.com、www.zjuwlan.com（Web 别名）、ftp.zjuwlan.com（FTP 别名） |
    | 无线路由器 | 局域网核心设备                 | LAN 口 192.168.1.1 | WAN 口连校网 | SSID 需标 5G，通道号按大组分配                                                                 |

### 二、实验前置准备

- 无线路由器配置
    1. 登录路由器管理界面，设置 LAN 口 IP 为 192.168.1.1（默认网关）。
    2. 开启 DHCP 服务器，确保客户端可自动获取 IP（或手动配置静态 IP）。
    3. WAN 口配置：连通校网，确保三台 PC 能 ping 通实验室出口 10.78.18.254。
    4. 无线设置：SSID 避免重复（建议按大组命名），设置对应通道号，避免干扰。

- 三台 PC 的基础网络配置
    1. 右键桌面右下角无线网络图标→“网络和 Internet”设置→“更改适配器选项”→右键“WLAN”→“属性”。
    2. 双击“Internet 协议版本 4（TCP/IPv4）”，按以下参数配置（三台 PC 统一）：
         - IP 地址：按拓扑表手动设置（如 PC1 为 192.168.1.10）。
         - 子网掩码：255.255.255.0。
         - 默认网关：192.168.1.1（路由器 LAN 口 IP）。
         - 首选 DNS 服务器：192.168.1.10（主 DNS）。
         - 备用 DNS 服务器：192.168.1.11（辅 DNS）。
    3. 验证：三台 PC 之间能相互 `ping` 通，且均能 `ping` 通校网出口 10.78.18.254。

### 三、DNS 服务器详细配置

- 主 DNS 服务器（PC1，192.168.1.10）配置

    - 连接 DNS 服务器

        1. 点击“开始”→“Windows 管理工具”→“DNS”，打开 DNS 管理器。
        2. 右键“DNS”→“连接到 DNS 服务器”→选择“此计算机”→“确定”（若已自动连接则无需操作，重复连接会报错）。
        3. 若连接失败：打开“服务”→启动“DNS Server”服务；若仍失败，检查网卡是否连入路由器（需设置网关），禁用再启用网卡后重试。

    - 配置正向和反向查找区域

        1. 右键本地 DNS 服务器名称（如 EBASE-R01）→“配置 DNS 服务器”→“下一步”。
        2. 选择“创建正向和反向查找区域”→“下一步”。
        3. 正向查找区域配置：
             - 选择“是，创建正向查找区域”→“下一步”。
             - 区域类型：“主要区域”→“下一步”（主 DNS 存储正本数据）。
             - 区域名称：输入 zjuwlan.com（大组统一，可自定义）→“下一步”。
             - 区域文件：默认“zjuwlan.com.dns”→“下一步”。
             - 动态更新：“不允许动态更新”（手动维护记录）→“下一步”。
        4. 反向查找区域配置：
             - 选择“是，现在创建反向查找区域”→“下一步”。
             - 区域类型：“主要区域”→“下一步”。
             - 地址类型：“IPv4 反向查找区域”→“下一步”。
             - 网络 ID：输入 192.168.1（网段前缀）→“下一步”（自动生成反向区域名称 1.168.192.in-addr.arpa）。
             - 区域文件：默认“1.168.192.in-addr.arpa.dns”→“下一步”。
             - 动态更新：“不允许动态更新”→“下一步”。
        5. 转发器配置：
             - 选择“是，应当将查询转发到下列 IP 地址的 DNS 服务器上”。
             - 添加校网 DNS：10.10.0.21 和 10.10.2.21→“下一步”→“完成”（若提示根服务器连接错误，直接关闭不影响实验）。

    - 添加主机和别名记录

        - 添加主机记录（正向+反向映射）

            1. 展开“正向查找区域”→右键“zjuwlan.com”→“新建主机”。

            2. 依次添加 3 条主机记录（选中“创建相关的指针(PTR)记录”，自动生成反向记录）：

                 | 主机名        | 完整域名                            | IP 地址             | 角色                                 |
                 | --------- | --------------------- | ------------ | -------------------- |
                 | server1     | server1.zjuwlan.com     | 192.168.1.10 | 主 DNS 服务器                |
                 | server2     | server2.zjuwlan.com     | 192.168.1.11 | 辅 DNS 服务器                |
                 | webserver | webserver.zjuwlan.com | 192.168.1.22 | IIS（Web&FTP）服务器 |

            3. 点击“添加主机”→“完成”。

        - 添加别名记录（CNAME）

            1. 右键“zjuwlan.com”→“新建别名”。
            2. 添加 WWW 别名（Web 服务访问）：
                 - 别名：www→目标主机完全合格域名：webserver.zjuwlan.com→“确定”（用户可通过 www.zjuwlan.com 访问 Web 服务器）。
            3. 添加 FTP 别名（FTP 服务访问）：
                 - 别名：ftp→目标主机完全合格域名：webserver.zjuwlan.com→“确定”（用户可通过 ftp.zjuwlan.com 访问 FTP 服务器）。

    - 配置区域传送（关键！）

        1. 正向查找区域：右键“zjuwlan.com”→“属性”→“区域传送”选项卡。
        2. 选择“允许区域传送”→“到所有服务器”（或“只允许到下列服务器”，添加辅 DNS IP 192.168.1.11）→“应用”→“确定”。
        3. 反向查找区域：右键“1.168.192.in-addr.arpa”→“属性”→“区域传送”→同上配置→“确定”（否则辅 DNS 无法获取数据）。

    - 配置结果检查

        - 正向查找区域（zjuwlan.com）：包含 5 条记录（SOA、NS、3 条 A 记录、2 条 CNAME 记录）。
        - 反向查找区域（1.168.192.in-addr.arpa）：包含 3 条 PTR 记录（对应 3 台主机的 IP→域名映射），若未显示，右键区域→“刷新”。

- 辅 DNS 服务器（PC2，192.168.1.11）配置

    - 连接主、辅 DNS 服务器
        1. 打开 DNS 管理器→右键“DNS”→“连接到 DNS 服务器”。
        2. 连接辅 DNS（本地）：选择“此计算机”→“确定”。
        3. 连接主 DNS（PC1）：选择“下列计算机”→输入 192.168.1.10→“确定”（需主、辅 PC 网络连通）。

    - 配置正向和反向查找区域
        1. 右键本地 DNS 服务器名称→“配置 DNS 服务器”→“下一步”→“创建正向和反向查找区域”→“下一步”。
        2. 正向查找区域配置：
             - 选择“是，创建正向查找区域”→“下一步”。
             - 区域类型：“辅助区域”→“下一步”（辅 DNS 存储副本数据）。
             - 区域名称：输入 zjuwlan.com（与主 DNS 一致）→“下一步”。
             - 主 DNS 服务器：输入 192.168.1.10→“添加”→“下一步”。
        3. 反向查找区域配置：
             - 选择“是，现在创建反向查找区域”→“下一步”。
             - 区域类型：“辅助区域”→“下一步”。
             - 地址类型：“IPv4 反向查找区域”→“下一步”。
             - 网络 ID：192.168.1→“下一步”。
             - 主 DNS 服务器：输入 192.168.1.10→“添加”→“下一步”。
        4. 转发器配置：添加校网 DNS 10.10.0.21 和 10.10.2.21→“下一步”→“完成”。

    - 配置结果检查与问题处理
        - 检查：正向查找区域（zjuwlan.com）应自动同步主 DNS 的 5 条记录，反向区域同步 3 条 PTR 记录（若未显示，稍等片刻按 F5 刷新）。
        - 常见问题：辅 DNS 无法获取主 DNS 数据？
            1. 主 DNS 未配置区域传送（回到主 DNS 重新设置“允许区域传送”）。
            2. 主、辅 PC 网络不通（检查 IP、网关，重新 `ping` 通）。
            3. 解决方案：在辅 DNS 中右键同步失败的区域→“重新加载”；或删除区域后重新新建。

- DNS 服务验证方法

    - ping 命令验证
        1. 在任意 PC（如 PC3）打开命令提示符→输入 `ping www.zjuwlan.com`，应返回 192.168.1.22（Web 服务器 IP），且无丢包（4/4 接收）。
        2. 输入 `ping ftp.zjuwlan.com`，同样返回 192.168.1.22→别名配置成功。
        3. 输入 `ping www.baidu.com`，应返回百度 IP（如 61.135.169.125）→转发器配置成功（本实验 DNS 无百度记录，需转发到校网 DNS 解析）。

    - nslookup 命令验证
        1. 基本解析：输入 `nslookup server1.zjuwlan.com`，应返回服务器地址 192.168.1.10，名称 server1.zjuwlan.com→正向解析成功。
        2. 反向解析：输入 `nslookup 192.168.1.22`，应返回名称 webserver.zjuwlan.com→反向解析成功。
        3. 辅 DNS 单独验证：输入 `nslookup www.zjuwlan.com 192.168.1.11`（指定辅 DNS 解析），结果与主 DNS 一致→辅 DNS 容错功能正常。

### 四、IIS 服务器详细配置（PC3，192.168.1.22）

- Web 服务器配置
    - 打开 IIS 管理器
        点击“开始”→“Windows 管理工具”→“Internet Information Services (IIS) 管理器”。

    - 新建 Web 站点
        1. 停止默认网站：右键“Default Web Site”→“停止”（避免 80 端口冲突）。
        2. 新建网站：右键“网站”→“添加网站”，配置以下参数：
             - 网站名称：自定义（如 left456Web）。
             - 物理路径：选择 C/D 盘新建文件夹（如 C:\myweb，需 NTFS 格式）→“测试设置”（确保无权限错误）。
             - 绑定：类型 http，IP 地址“全部未分配”，端口 80（默认，若修改需在访问时加端口号，如 http://xxx:8080），主机名留空→“确定”。
        3. 若提示“80 端口已被占用”：确认默认网站已停止，点击“是”即可（无冲突）。

    - 关键设置（必做！）
        - 配置默认文档
            1. 选中新建的 Web 站点（如 left456Web）→双击“默认文档”功能。
            2. 点击“添加”→输入自定义首页文件名（如 left456Web.htm）→“确定”。
            3. 选中该文件名→点击“上移”至列表顶部（优先访问）。
            4. 准备首页文件：用 Microsoft Expression Web 或 Word 编辑 HTML 文件，内容需包含“这是 AAA、BBB…的 Web 网站！”（AAA、BBB 为大组同学姓名），保存至网站物理路径（如 C:\myweb）。

        - 配置身份验证
            1. 选中 Web 站点→双击“身份验证”功能。
            2. 启用“匿名身份验证”（右侧操作栏→“启用”）→禁用其他身份验证（如 Windows 身份验证、基本身份验证）。
            3. 关键权限配置（避免“无权限访问”错误）：
                 - 打开网站物理路径文件夹（如 C:\myweb）→右键“属性”→“安全”选项卡。
                 - 点击“编辑”→“添加”→输入“IUSR”（Internet 来宾账户）→“检查名称”→“确定”。
                 - 为 IUSR 分配“读取”“读取和执行”“列出文件夹内容”权限→“应用”→“确定”。
                 - 若仍报 500.19 错误：为该文件夹添加“Users”用户组的“读取和执行”权限。

    - Web 站点验证
        1. 本地验证：在 PC3 浏览器输入 `localhost` 或 `http://192.168.1.22`，显示自定义首页内容→本地访问正常。
        2. 局域网验证：在 PC1/PC2 浏览器输入 `http://www.zjuwlan.com`（通过 DNS 解析），显示首页内容→Web 服务正常。

- FTP 服务器配置
    - 新建 FTP 站点
        1. 右键“网站”→“添加 FTP 站点”，配置以下参数：
             - FTP 站点名称：自定义（如 left456FTP）。
             - 物理路径：选择 C/D 盘新建文件夹（如 C:\MyFTP，需 NTFS 格式）→“下一步”。
             - 绑定：IP 地址“全部未分配”，端口 21（默认），SSL 设置“无 SSL”（默认“需要 SSL”会导致无法访问）→“下一步”。
             - 身份验证和授权：勾选“匿名”身份验证，允许访问“所有用户”，权限勾选“读取”和“写入”（支持上传文件）→“完成”。

    - 权限配置（必做！）
        1. 打开 FTP 站点物理路径（如 C:\MyFTP）→右键“属性”→“安全”选项卡。
        2. 为 IUSR 账户分配“读取”“写入”“读取和执行”“列出文件夹内容”权限（上传文件需“写入”权限）→“应用”→“确定”。

    - FTP 站点验证
        1. 本地验证：在 PC3 打开“此电脑”→地址栏输入 `ftp://localhost` 或 `ftp://192.168.1.22`，无需登录（匿名）即可访问，新建文件夹或上传文件（命名为“这是 AAA、BBB…的 FTP 站点！”）→本地访问正常。
        2. 局域网验证：在 PC1/PC2 地址栏输入 `ftp://ftp.zjuwlan.com`（通过 DNS 解析），能访问并上传文件→FTP 服务正常。

- 常见问题解决
    1. 无法访问 Web/FTP 站点：检查 IUSR 账户权限是否配置，文件夹是否为 NTFS 格式。
    2. Web 站点报“404 未找到”：默认文档未添加或首页文件未放入物理路径。
    3. FTP 无法上传文件：未勾选“写入”权限，或 IUSR 无“写入”权限。
    4. 端口冲突：Web 端口 80 被占用（检查默认网站是否停止），FTP 端口 21 被占用（更换端口号）。

### 五、实验分工与结果检查

- 实验分工建议
    - 小组 1：配置无线路由器+主 DNS 服务器（PC1）。
    - 小组 2：配置辅 DNS 服务器（PC2）（需在主 DNS 配置完成后进行）。
    - 小组 3：配置 IIS 服务器（PC3）（可与 DNS 配置同步进行）。

- 实验结果检查标准
    - 功能验证（三台 PC 均需通过）
        - Web 访问：`http://www.zjuwlan.com` 显示含大组同学姓名的首页。
        - FTP 访问：`ftp://ftp.zjuwlan.com` 能匿名访问并上传文件。
        - 域名解析：`nslookup server1.zjuwlan.com`、`nslookup webserver.zjuwlan.com` 均返回正确 IP。
        - 外网解析：`ping www.baidu.com` 能返回正确 IP（转发器正常）。

    - 界面检查（需打开以备查看）
        - DNS 管理器：主、辅 DNS 的正向/反向查找区域记录完整。
        - IIS 管理器：Web 站点和 FTP 站点处于“启动”状态，默认文档、身份验证配置正确。
        - 文件夹权限：Web/FTP 物理路径的 IUSR 权限配置正确。

### 六、思考题解答

问题：在主 DNS 服务器工作正常的情况下，如何单独检查辅 DNS 服务器能否正常解析域名？

解答：使用 `nslookup` 命令指定辅 DNS 服务器的 IP 地址进行解析，格式为：`nslookup 待解析域名 辅 DNS IP`。 

示例：`nslookup www.zjuwlan.com 192.168.1.11`。

若返回正确 IP（192.168.1.22），则辅 DNS 解析功能正常；若超时或返回错误，则辅 DNS 配置存在问题（如区域传送未授权、网络不通）。