第三次课

- 一、IP 地址和子网掩码
    - IP 地址的用途
        - 标识网络中特定主机的 **逻辑地址**，需唯一无冲突，用于 Internet 通信。
        - 每个数据包包含源 IP 和目的 IP，网络设备通过地址确保数据收发准确。
        - 分配对象：网卡（NIC）、工作站、服务器、IP 电话、智能手机等终端，以及路由器接口（如默认网关）。
        - 特殊情况：单块网卡可配置多个 IP 地址（无线 AP 实验关键）。
    - IPv4 地址的结构
        - 本质：32 位二进制数字串，采用 **点分十进制记法**（8 位为一组，共 4 个八位字节）。
        - 格式示例：192.168.1.5、10.10.10.34，每个八位字节取值范围 0-255（对应二进制 00000000-11111111）。
        - 地址总量：2³²≈40 亿个，是目前 Internet 最通用的 IP 地址形式。
    - IPv4 地址的组成部分
        - 层次性结构：分为 **网络部分**（标识主机所属网络）和 **主机部分**（标识网络内特定主机），缺一不可。
        - 示例：IP 地址 192.168.1.100，默认前 3 个八位字节（192.168.1）为网络部分，最后 1 个（100）为主机部分（分层寻址：先找网络，再找主机）。
        - 对比：IP 地址是分层寻址（类似通信地址），MAC 地址是无层次寻址（类似人名）。
    - 子网掩码
        - 定义：32 位二进制数，点分十进制记法，用于区分 IP 地址的网络部分和主机部分。
        - 规则：二进制形式“前一串 1+后一串 0”，“1”对应网络部分（含子网部分，详见第六次课），“0”对应主机部分。
        - 常见类型（家庭/小型企业常用）：
            - 255.0.0.0（8 位 1，记为 /8，格式 N.H.H.H）
            - 255.255.0.0（16 位 1，记为 /16，格式 N.N.H.H）
            - 255.255.255.0（24 位 1，记为 /24，格式 N.N.N.H）
        - 核心意义：无子网掩码的 IP 地址无实际意义，决定主机 ID 的比特位数（在线考试考点）。
    - 子网掩码相关计算题
        - （1）可分配主机数量计算
            - 公式：2^（主机部分位数）- 2
            - 原理：主机部分全 0 为网络地址，全 1 为广播地址，均不可分配给主机。
            - 示例：子网掩码 255.255.255.0（主机部分 8 位），可分配主机数 = 2⁸ - 2 = 254。
        - （2）网络地址计算
            - 方法：IP 地址与子网掩码转换为二进制后，逐位进行 **逻辑与运算**（0&0=0、0&1=0、1&0=0、1&1=1）。
            - 结果：网络部分保留，主机部分全 0，即该 IP 所属的网络地址。
            - 示例：IP 192.168.1.44 + 子网掩码 255.255.255.0，运算后网络地址为 192.168.1.0。
    - 通信逻辑判断
        - 同一网络：源 IP 与目的 IP 的网络地址相同，数据包本地传送（不经过路由器）。
        - 不同网络：网络地址不同，数据包转发至默认网关，再路由至目标网络。
        - 实验关键：设备通信需“物理通+逻辑通”，若 ping 不通/无法访问，大概率是 IP 不在同一逻辑网络（需修改 IP 至同一网段）。

- 二、IPv4 地址的类型
    - 地址分类（A/B/C/D/E 类）
        - 表格说明：
        
            | 地址类 | 第一个八位字节范围 | 地址最高位特征  | 网络部分 / 主机部分         | 默认子网掩码         | 可容纳网络数       | 每个网络可容纳主机数         | 适用场景 |
            | ------ | ------------------ | --------------- | --------------------------- | -------------------- | ------------------ | ---------------------------- | -------- |
            | A 类   | 1-127              | 最高位为 0      | 1 个八位字节 / 3 个八位字节 | 255.0.0.0（/8）      | 2^(8-1)-2=126      | 2^24-2=16777214（约 1600 万） | 大型组织 |
            | B 类   | 128-191            | 最高两位为 10   | 2 个八位字节 / 2 个八位字节 | 255.255.0.0（/16）   | 2^(16-2)-2=65534   | 2^16-2=65534（约 6.5 万）     | 中型网络 |
            | C 类   | 192-223            | 最高三位为 110  | 3 个八位字节 / 1 个八位字节 | 255.255.255.0（/24） | 2^(24-3)-2=2097150 | 2^8-2=254                     | 小型网络 |
            | D 类   | 224-239            | 最高四位为 1110 | -（组播专用）               | -                    | 无（组播地址池）   | 无（不可分配给主机）         | 组播通信 |
            | E 类   | 240-255            | 最高四位为 1111 | -（实验专用）               | -                    | 无（预留未分配）   | 无（不可分配给主机）         | 科研测试 |

            - 补充说明：

                - 可容纳网络数计算逻辑：网络部分需扣除 “全 0”（网络地址无效）和 “全 1”（广播地址无效）的特殊情况，故减去 2；A 类最高位固定为 0（占 1 位），网络位实际可用 7 位；B 类最高两位固定为 10（占 2 位），网络位实际可用 14 位；C 类最高三位固定为 110（占 3 位），网络位实际可用 21 位。
                - 每个网络可容纳主机数计算逻辑：主机部分扣除 “全 0”（网络地址）和 “全 1”（广播地址）的特殊情况，故减去 2。

            - 示例：清华 166.111.\*.\*（B 类），浙大 210.32.\*.\*（C 类）、后来 222.205.\*.\*（C 类），北大 162.105.\*.\*（B 类）。


​        
    - 公有地址与私有地址
        - （1）核心背景
            - IPv4 地址已耗尽（2011 年 ICANN 宣布分配完毕），私有地址是缓解方案，仅用于内部网络，不可直接访问 Internet。
        - （2）私有地址范围（RFC1918 标准）
            - A 类：10.0.0.0-10.255.255.255（1 个网络，约 1600 万地址/网络）
            - B 类：172.16.0.0-172.31.255.255（16 个网络，约 6.5 万/网络）
            - C 类：192.168.0.0-192.168.255.255（256 个网络，254/网络）
        - （3）关键特性
            - 私有地址不可在 Internet 路由，多个组织可重复使用，无冲突风险。
            - 安全优势：外部无法直接访问私有地址（如 Ping 通）。
            - 访问 Internet 的前提：通过 **网络地址转换（NAT）** 将私有地址转为公有地址。
    - NAT（网络地址转换）
        - 作用：实现私有地址与公有地址的双向转换，是内网访问外网的核心技术。
        - 工作原理：
            - 传出（内网→外网）：将数据包的私有源 IP 转为公有源 IP（如路由器 WAN 口地址）。
            - 传入（外网→内网）：将公有目的 IP 转为私有目的 IP。
        - 比喻：类似公司前台，通过“总机号码（公有地址）”转接“内部分机号（私有地址）”。
        - 路由器接口要求：LAN 口（内网）与 WAN 口（外网）IP 必须属于不同网络。
	- 特殊 IPv4 地址
		- 环回地址：127.0.0.0 /8（127.0.0.1 至 127.255.255.254），核心用途是测试网卡及 TCP/IP 协议安装是否正常，主机通过该地址将流量指向自身（localhost=127.0.0.1），无需经过物理网络。
		- APIPA 地址：169.254.0.0 /16（169.254.0.1 至 169.254.255.254），属于自动私有 IP 编址，仅 Windows 主机在无 DHCP 服务器分配 IP 时自动配置（自我配置），出现该地址通常意味着地址异常、通信一般也异常；Linux 和 OS X 系统自动获取 IP 失败时不会分配此类地址。
		- TEST-NET 地址：192.0.2.0 /24（192.0.2.0 至 192.0.2.255），专门留作教学、文档示例及网络测试使用，不用于实际生产网络部署。
    - 单播、广播、组播地址
        - （1）单播地址
            - 用途：一对一通信，标识特定主机。
            - 要求：数据包需同时包含单播 IP 地址（包头）和单播 MAC 地址（以太网帧头）。
        - （2）广播地址
            - 用途：一对所有通信，本地网络（广播域）所有主机接收数据包。
            - IP 格式：主机部分全 1（如 C 类 192.168.1.0 的广播地址为 192.168.1.255）。
            - MAC 格式：FF-FF-FF-FF-FF-FF（48 位全 1）。
            - 应用：ARP、DHCP 等协议依赖广播。
        - （3）组播地址
            - 用途：一对多通信（如远程游戏、视频会议）。
            - IP 范围：224.0.0.0-239.255.255.255（D 类地址），仅作为目的地址，源地址为单播。
            - MAC 格式：以 01-00-5E 开头，后 23 位取自组播 IP 的低 23 位。

- 三、IPv6 地址
    - 引入背景
        - IPv4 局限：地址总量仅 40 亿，无法满足亿级新设备（手机、家电、物联网设备）需求，2011 年已耗尽。
        - IPv6 优势：128 位地址空间，总量达 3.4×10³⁸ 个（地球每平方米约 6.6×10²⁰ 个地址），彻底解决地址短缺问题。
    - IPv6 地址结构与表示方法
        - 本质：128 位二进制数，分为 8 组 16 位二进制数，每组用十六进制表示（不区分大小写）。
        - 格式：x\:x\:x\:x\:x\:x\:x\:x（如 2031:0000:130F:0000:0000:09C0:876A:130B）。
        - 简化规则：
            - 组内前导零可省略（如 09C0→9C0）。
            - 连续零组可缩写为“::”，每个地址仅用一次（如 0:0:0:0:0:0:0:1→::1）。
        - 前缀长度：类似 IPv4 子网掩码，用“/前缀长度”表示（范围 0-128，典型为/64），前半部分为前缀（网络部分），后半部分为接口 ID（主机部分）。
    - IPv6 地址类型
        - （1）单播地址（唯一标识设备接口）
            - 全局单播地址（GUA）：类似 IPv4 公有地址，Internet 可路由，分配自 2000::/3 地址块（ICANN→RIR→组织）。
            - 本地链路地址（LLA）：地址块 FE80::/10，用于同一链路/子网内通信，每个 IPv6 接口必配（自动生成或手动配置）。
            - 唯一本地地址：类似 IPv4 私有地址，地址块 FC00::/7，用于内部网络或少量站点间通信。
        - （2）组播地址（一对多通信）
            - 前缀：FF00::/8，分为分配的组播地址和请求节点组播地址。
            - 常见分配组播地址：
                - FF02::1：全节点组播组（所有 IPv6 设备接收，替代 IPv4 广播）。
                - FF02::2：全路由组播组（所有 IPv6 路由器接收）。
            - 请求节点组播地址：格式 FF02::1:FFxx:xxxx，后 24 位取自设备单播地址后 24 位，映射特殊以太网 MAC 地址，用于帧过滤。
        - （3）任播地址（分配给多个设备）
            - 用途：数据包路由至最近的拥有该地址的设备，IPv6 特有（无广播地址）。
    - IPv4 与 IPv6 共存技术
        - 双堆栈：设备同时运行 IPv4 和 IPv6 协议栈，支持两种地址通信。
        - 隧道：将 IPv6 数据包封装到 IPv4 数据包中，通过 IPv4 网络传输。
        - 转换（NAT64）：实现 IPv6 设备与 IPv4 设备的通信，完成数据包协议转换。
    - 中国 IPv6 发展政策与目标
        - （1）核心规划
            - 2017 年《推进互联网协议第六版（IPv6）规模部署行动计划》：5-10 年建成全球最大 IPv6 商业应用网络。
            - 2021-2023 年《IPv6 流量提升三年专项行动计划》：推动 IPv6 从“通路”到“通车”，从“能用”到“好用”。
            - 2025 年目标：IPv6 活跃用户 8.5 亿，物联网 IPv6 连接数 11 亿，移动网络 IPv6 流量占比 70%，固定网络占比 27%。
        - （2）关键任务
            - 网络改造：LTE 网络、固定网络、互联网骨干直联点 IPv6 改造。
            - 终端支持：新生产终端（手机、路由器、智能电视）默认支持 IPv4/IPv6 双栈，存量终端升级。
            - 应用升级：政府网站、Top100 互联网应用、工业互联网、物联网等 IPv6 改造。

- 四、获取 IP 地址的方式
    - 静态地址分配
        - （1）配置方式
            - 网络管理员手工配置主机网络信息，至少包含：IP 地址、子网掩码、默认网关（可选 DNS 服务器地址）。
            - 操作步骤（Win10/2019）：网络图标→网络和 Internet 设置→更改适配器选项→网卡属性→Internet 协议版本 4（TCP/IPv4）→手动输入参数。
            - 操作步骤（Win11）：控制面板→网络和共享中心→更改适配器选项→网卡属性→TCP/IPv4→手动输入参数。
        - （2）优缺点
            - 优点：地址固定，适合服务器、网络打印机等需稳定访问的设备。
            - 缺点：配置繁琐，用户数量变化时需手动调整，易出现地址冲突。
    - 动态地址分配（DHCP）
        - （1）配置方式
            - 通过 **动态主机配置协议（DHCP）** 自动分配 IP 地址、子网掩码、默认网关、DNS 等信息（详见第六次课）。
            - 操作步骤：TCP/IPv4 属性中选择“自动获得 IP 地址”“自动获得 DNS 服务器地址”。
            - 无线网卡特殊设置（Win10/11）：网络和 Internet 设置→WLAN→对应网络→IP 分配→选择“自动（DHCP）”。
        - （2）优缺点
            - 优点：配置便捷，自动分配地址，避免冲突，适合用户数量频繁变化的网络（如办公网、校园网）。
            - 缺点：地址动态变化，不适合需固定地址访问的设备。
    - 特殊操作：单块网卡配置多个 IP 地址
        - 意义：解决无线 AP 实验思考题的关键。
        - 配置路径：TCP/IPv4 属性→高级→添加多个 IP 地址和子网掩码（需手动输入不同网段或同网段的不同 IP）。
